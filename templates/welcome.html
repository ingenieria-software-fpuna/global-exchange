{% extends "base.html" %}
{% load moneda_extras %}

{% block title %}Global Exchange - Casa de Cambios{% endblock %}

{% block extra_css %}
<style>
/* Ticker styles scoped to welcome */
.ticker { position: relative; overflow: hidden; background:#fff; border-radius:.75rem; }
.ticker__track {
    display:flex; align-items:center; gap:2rem; white-space:nowrap;
    animation: ticker-scroll 35s linear infinite;
    padding: .75rem 1rem;
}
.ticker:hover .ticker__track { animation-play-state: paused; }
.ticker__item { display:flex; align-items:center; gap:.5rem; color:#0f172a; }
.ticker__label { color:#6c757d; font-size:.9rem; }
.ticker__value { font-weight:700; color:#198754; }
@keyframes ticker-scroll {
  0% { transform: translateX(0); }
  100% { transform: translateX(-50%); }
}
@media (prefers-reduced-motion: reduce) { .ticker__track { animation:none; } }
</style>
{% endblock %}

{% block main_container_class %}container-fluid p-0{% endblock %}

{% block content %}
<!-- Hero principal -->
<section class="bg-primary text-white py-5 shadow-soft" style="background: linear-gradient(135deg, rgba(13,110,253,1) 0%, rgba(2,62,138,1) 100%);">
    <div class="container py-4">
        <div class="row align-items-center g-4">
            <div class="col-12 text-center">
                <h1 class="display-5 fw-bold mb-2">Global Exchange</h1>
                <p class="lead mb-4">Tu casa de cambios de confianza</p>
                <div class="d-flex justify-content-center gap-2 flex-wrap">
                    {% if user.is_authenticated %}
                    <a href="{% url 'auth:dashboard' %}" class="btn btn-light btn-lg btn-rounded px-4">
                        <i class="fas fa-gauge-high me-2"></i>Ir al Dashboard
                    </a>
                    <a href="{% url 'auth:logout' %}" class="btn btn-outline-light btn-lg btn-rounded px-4">
                        <i class="fas fa-right-from-bracket me-2"></i>Cerrar Sesión
                    </a>
                    {% else %}
                    <a href="{% url 'auth:login' %}" class="btn btn-light btn-lg btn-rounded px-4">
                        <i class="fas fa-right-to-bracket me-2"></i>Iniciar Sesión
                    </a>
                    <a href="{% url 'auth:registro' %}" class="btn btn-outline-light btn-lg btn-rounded px-4">
                        <i class="fas fa-user-plus me-2"></i>Registrarse
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    <div class="bg-white" style="height: 24px; clip-path: polygon(0 0, 100% 0, 100% 100%, 0 60%);"></div>
</section>

<!-- Ticker de tasas en movimiento -->
{% if monedas_con_tasas %}
<section class="py-3">
  <div class="container">
    <div class="ticker shadow-soft" role="region" aria-label="Tasas de cambio en movimiento">
      <div class="ticker__track">
        <!-- Bloque 1 -->
        {% for item in monedas_con_tasas %}
        <span class="ticker__item">
          <i class="{{ item.moneda.codigo|get_icono_moneda }} text-primary"></i>
          <span class="ticker__label">{{ item.moneda.codigo }}</span>
          <span class="ticker__value">{{ item.tasa.tasa_venta|formatear_tasa_para_display:item.moneda.decimales }}</span>
          <span class="text-muted">
            Compra {{ item.tasa.tasa_compra|formatear_tasa_para_display:item.moneda.decimales }} · 
            Venta {{ item.tasa.tasa_venta|formatear_tasa_para_display:item.moneda.decimales }}
          </span>
        </span>
        {% endfor %}

        <!-- Bloque 2 (duplicado para desplazamiento infinito) -->
        {% for item in monedas_con_tasas %}
        <span class="ticker__item">
          <i class="{{ item.moneda.codigo|get_icono_moneda }} text-primary"></i>
          <span class="ticker__label">{{ item.moneda.codigo }}</span>
          <span class="ticker__value">{{ item.tasa.tasa_venta|formatear_tasa_para_display:item.moneda.decimales }}</span>
          <span class="text-muted">
            Compra {{ item.tasa.tasa_compra|formatear_tasa_para_display:item.moneda.decimales }} · 
            Venta {{ item.tasa.tasa_venta|formatear_tasa_para_display:item.moneda.decimales }}
          </span>
        </span>
        {% endfor %}
      </div>
    </div>
  </div>
  <div class="bg-white" style="height: 16px;"></div>
</section>
{% endif %}

<!-- Tasas de cambio -->
{% if monedas_con_tasas %}
<section class="py-5">
    <div class="container">
        <div class="text-center mb-5">
            <h2 class="h1 text-primary mb-2">Tasas de Cambio</h2>
            <p class="text-muted">Moneda base: Guaraní (PYG)</p>
        </div>

        <div class="row g-4 justify-content-center">
            {% for item in monedas_con_tasas %}
            <div class="col-12 col-sm-6 col-md-4 col-lg-3">
                <div class="card h-100">
                    <div class="card-body text-center">
                        <div class="display-6 text-primary mb-2">
                            <i class="{{ item.moneda.codigo|get_icono_moneda }}"></i>
                        </div>
                        <h5 class="card-title">{{ item.moneda.nombre }}</h5>
                        <p class="mb-1">
                            <span class="h4 text-success">{{ item.tasa.tasa_venta|formatear_tasa_para_display:item.moneda.decimales }}</span>
                            <small class="text-muted"> PYG/{{ item.moneda.codigo }}</small>
                        </p>
                        <small class="text-muted">
                            Compra: {{ item.tasa.tasa_compra|formatear_tasa_para_display:item.moneda.decimales }} · 
                            Venta: {{ item.tasa.tasa_venta|formatear_tasa_para_display:item.moneda.decimales }}
                        </small>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <div class="row mt-5">
            <div class="col-12">
                <div class="alert alert-info shadow-sm text-center" role="alert">
                    <i class="fas fa-circle-info me-2"></i>
                    <strong>Nota:</strong> Las tasas se actualizan cada hora. Para operaciones específicas, contacta con nuestros agentes.
                </div>
            </div>
        </div>
    </div>
    <div class="bg-white" style="height: 24px; clip-path: polygon(0 0, 100% 40%, 100% 100%, 0 100%);"></div>
</section>
{% else %}
<!-- Mensaje cuando no hay monedas disponibles -->
<section class="py-5">
    <div class="container">
        <div class="text-center">
            <div class="alert alert-warning shadow-sm" role="alert">
                <i class="fas fa-exclamation-triangle me-2"></i>
                <strong>No hay tasas de cambio disponibles</strong>
                <p class="mb-0 mt-2">Por favor, contacta con el administrador para configurar las monedas y sus tasas de cambio.</p>
            </div>
        </div>
    </div>
</section>
{% endif %}

<!-- Características -->
<section class="py-5 bg-light">
    <div class="container">
        <div class="row g-4">
            <div class="col-12 col-md-4">
                <div class="card h-100">
                    <div class="card-body">
                        <div class="text-primary fs-3 mb-2"><i class="fas fa-shield-halved"></i></div>
                        <h5 class="mb-2">Seguro</h5>
                        <p class="text-muted mb-0">Protección y cumplimiento para cada operación.</p>
                    </div>
                </div>
            </div>
            <div class="col-12 col-md-4">
                <div class="card h-100">
                    <div class="card-body">
                        <div class="text-primary fs-3 mb-2"><i class="fas fa-bolt"></i></div>
                        <h5 class="mb-2">Rápido</h5>
                        <p class="text-muted mb-0">Procesos ágiles y sin fricciones.</p>
                    </div>
                </div>
            </div>
            <div class="col-12 col-md-4">
                <div class="card h-100">
                    <div class="card-body">
                        <div class="text-primary fs-3 mb-2"><i class="fas fa-scale-balanced"></i></div>
                        <h5 class="mb-2">Transparente</h5>
                        <p class="text-muted mb-0">Precios claros y actualizados.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Llamado a la acción -->
<section class="py-5">
    <div class="container">
        <div class="d-flex flex-column flex-md-row align-items-center justify-content-between p-4 p-md-5 bg-white rounded-3 shadow-soft">
            <div class="mb-3 mb-md-0">
                <h4 class="mb-1">¿Listo para comenzar?</h4>
                <p class="text-muted mb-0">Crea tu cuenta o inicia sesión para operar.</p>
            </div>
            <div class="d-flex gap-2">
                {% if user.is_authenticated %}
                <a href="{% url 'auth:dashboard' %}" class="btn btn-primary btn-rounded px-4">
                    <i class="fas fa-gauge-high me-2"></i>Ir al Dashboard
                </a>
                {% else %}
                <a href="{% url 'auth:login' %}" class="btn btn-primary btn-rounded px-4">
                    <i class="fas fa-right-to-bracket me-2"></i>Iniciar Sesión
                </a>
                <a href="{% url 'auth:registro' %}" class="btn btn-outline-primary btn-rounded px-4">
                    <i class="fas fa-user-plus me-2"></i>Registrarse
                </a>
                {% endif %}
            </div>
        </div>
    </div>
</section>
{% endblock %}
